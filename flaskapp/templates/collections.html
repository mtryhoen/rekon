{% extends 'layout.html' %}

{% block body %}
    <div class="container text-left"  id="container2">
        <label>Collections</label>
        <p>Add a photo of a person to be recognized by the IP cameras</p>
        <input type="file" id="files" /> <br />
        <button id="btn-upload" type="button" class="btn btn-primary">Upload</button>
    </div>

  <script>
    var accessKeyId;
    var secretAccessKey;
    var sessionToken;

    document.getElementById("btn-upload").addEventListener("click", function(){
        console.log('uploading...');
        addPhoto();
    });

    function addPhoto() {
        var files = document.getElementById('files').files;
        if (!files.length) {
        return alert('Please choose a file to upload first.');
        }
        var file = files[0];
        var fileName = file.name;
        var user = '{{ session.username}}'

        var keyName = user + '/' + fileName;
        var s3 = new AWS.S3({
          apiVersion: '2006-03-01',
          params: {Bucket: 'rekon-collections'}
        });


      s3.upload({
        Key: keyName,
        Body: file
      }, function(err, data) {
        if (err) {
          return alert('There was an error uploading image: ', err.message);
        }
        console.log('Successfully uploaded photo.');
      });
    }

    awsCred(function(response){
        // Here you have access to your variable
        addPhoto()
    })
  </script>
{% endblock %}
